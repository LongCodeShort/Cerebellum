### Shell 解析器

```shell
# 查看解析器列表
sudo cat /etc/shells

# 查看系统默认解析器
echo $SHELL
```

------

### Shell 格式

- 脚本文件内容以 `#!/bin/bash` 开头（指定解析器）
- 脚本文件通常以.sh结尾便于区分为脚本文件
- 脚本运行:

```shell
# 使用sh解析器执行
sh test.sh

# 使用bash解析器执行
bash test.sh

# 执行文件，文件需要有执行权限(chmod +x test.sh)
./test.sh
```

------

### Shell 变量

- [常用系统变量](/linux/system_environment_variables.md)
- 自定义变量语法

 ```shell
 # 变量赋值：变量名=值，(注意：等号 左右不能有空格)
 A=1
 
 # 获取变量值: $变量名
 $A
 
 # 撤销变量：unset 变量名
 unset A
 
 # 声明静态变量 readonly 变量名=值，（注意：不能unset撤销，会报错）
 readonly A=2
 
 # export 变量名，提升变量为全局环境变量，在命令行使用当前bash生效（关闭当前shell终端失效）；在shell脚本中使用，只能在当前脚本中生效
 export A
 ```

- 变量定义规则

  1. 变量名称可以由字母、数字和下划线组成，不能以数字开头
  2. 环境变量名建议大写
  3. 等号两侧不能有空格
  4. 在bash中，变量默认类型为字符串，无法直接进行数值运算(效果为为字符串拼接)
  5. 变量的值如果有空格，需要用双引号或单引号括起来

- 特殊变量

```shell
# 脚本文件中使用，n为数字。$0为代表脚本名称、$1~$9代表第一到第九个参数，十以及以上的参数需要用大括号，例：${10}
$n

# 脚本文件中使用，获取所有输入参数的个数，常用于循环
$#

# 脚本文件中使用，代表命令行中输入的所有参数，遍历时用$n取出对应参数。当被双引号包含时（“$*”），此时遍历会以字符串形式输出所有结果
$* 

# 脚本文件中使用，代表命令行中输入的所有参数，遍历时用$n取出对应参数。当被双引号包含时（“$@”），遍历效果保持不变
$@

# 上一条命令的执行的状态。0表示执行正常、非0表示执行异常（通常自定义异常）
$?
```

------

### Shell 运算符

- 基本语法

  1. `$((运算式))` 或者 `$[运算式]` 
  2. `expr 运算式`，执行一次运算（注意：expr与运算式之间要有空格）
  3. 运算符：`+`加、 `-`减、 `\*`乘、 `/`除、 `%`取余（注意：运算式的运算符之间必须要有空格，左右无空格为字符串相加，单边无空格报错）

```shell
# 计算 (2 + 3) * 4
expr `expr 2 + 3` \* 4
r=$[(2+3)*4] && echo $r
```

------

### Shell 条件判断

- 基本语法：

  1. 单条件判断：`[ condition ]`
  2. condition前后必须要有空格
  3. 条件非空即为 true，`[  ]` 返回 false
  4. 多条件判断：
     - `&&`：表示前一条命令成功时才执行后一条命令
     - `||`：表示前一条命令执行失败后，才执行下一条命令

- 常用判断条件：

  1. 字符串比较：
      - `=`：相等
  2. 两个整数之间比较
    - `-lt`：小于
    - `-le`：小于等于
    - `-eq`：等于
    - `-gt`：大于
    - `-ge`：大于等于
    - `-ne`：不等于
  3. 按照文件权限进行判断
      - `-r`：有读权限
      - `-w`：有写权限
      - `-e`：文件存在
      - `-d`：文件存在且是一个目录
  
  ```shell
  # 23 是否大于等于 22(注：$?返回0表示条件成立，1表示条件不成立)
  [ 23 -ge 22 ]
  echo $?
  
  # 文件是否存在
  [ -e test.sh ]
  echo $?
  
  # 输出ok
  [ condition ] && echo ok || echo notok
  # 输出notok
  [ condition ] && [  ] || echo notok
  ```
  

------

### Shell 流程控制

###### if 判断

```shell
# 注意：if后必须由空格
# 语法1
if [ condition ];then
	...
fi

# 语法2
if [ condition ]
then
	...
fi

# 语法3
if [ condition ]
then
	...
elif []
then
	...
fi
```

###### case语句

```shell
# 基于语法
case $变量名 in
"值1")
	...
;;
"值2")
	...
;;
*)
	兜底执行语句...
;;
esac
```

###### for循环

```shell
# 语法1
for((初始值;循环控制条件;变量变化))
do
	...
done

# 语法2
for 变量 in 值1 值2 值3 ...
do
	...
done

# 1累加到100
s=0
for((i=1;i<=100;i++))
do
	s=$[$s+$i]
done

# 打印所有输入的参数
for i in $*
do
	echo $i
done
```

###### while循环

```shell
# 基本语法
while[ condition ]
do
	...
done

# 1累加到100
s=0
i=1
while[ $i -le 100 ]
do
	s=$[$s+$i]
	i=[$i+1]
done
```

------

### 函数

- [系统函数](/linux/system_functions.md)
- 自定义函数

```shell
# 注意：
# 1.下面中括号中的内容可写可不写
# 2.必须在调用函数之前声明函数
# 3.函数返回值，只能通过$?系统变量获取
# 4.return 如果不加，则以最后一条命令运行的结果作为返回值
# 5.函数返回值范围为 0~255

# 基本语法
[ function ] funName[()]
{
	Action;
	[return int;]
}
funName

# 定义求和函数并执行
function sum()
{
	s=0;
	s=$[$1+$2]
	echo $s
}

sum 4 5
```

